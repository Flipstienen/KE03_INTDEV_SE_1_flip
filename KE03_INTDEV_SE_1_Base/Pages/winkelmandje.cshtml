@page
@model winkelmandjeModel
@using System.Text.Json
@{
    ViewData["Title"] = "Winkelmandje";
}

<h1>@ViewData["Title"]</h1>

<div>
	<p>Hieronder staan de producten in uw winkelmandje:</p
</div>
<table>
  <thead>
    <tr>
      <th>Product</th>
      <th>Prijs</th>
      <th>Aantal</th>
      <th>Acties</th>
    </tr>
  </thead>
  <tbody>
    @foreach (var item in Model.products)
    {
      <tr>
        <td>@item.productName</td>
        <td>@item.price.ToString("C").Replace(",00",",-")</td>
        <td>
          <form method="post" asp-page-handler="Decrease" style="display:inline;">
            @Html.AntiForgeryToken()
            <input type="hidden" name="productName" value="@item.productName" />
            <button type="submit">-</button>
          </form>
          @item.quantity
          <form method="post" asp-page-handler="Increase" style="display:inline;">
            @Html.AntiForgeryToken()
            <input type="hidden" name="productName" value="@item.productName" />
            <button type="submit">+</button>
          </form>
        </td>
        <td>
          <form method="post" asp-page-handler="Remove">
            @Html.AntiForgeryToken()
            <input type="hidden" name="productName" value="@item.productName" />
            <button type="submit">🗑 Remove</button>
          </form>
        </td>
      </tr>
    }
  </tbody>
</table>
@if (ViewData["Message"] != null)
{
	<div>
		<p>@ViewData["Message"]</p>
	</div>
}

<button onclick="CartCheck()"> afrekenen</button>

<script>
    function CartCheck(){
        cart = @Html.Raw(Json.Serialize(Model.products))
        if (cart.length == 0)
        {
            var feedback = document.createElement("div");
            feedback.innerHTML = "Je winkelmandje is leeg, voeg eerst een product toe!";
            feedback.style.position = "fixed";
            feedback.style.top = "10px";
            feedback.style.right = "10px";
            feedback.style.backgroundColor = "#dc3545";
            feedback.style.color = "white";
            feedback.style.padding = "10px";
            feedback.style.borderRadius = "5px";
            feedback.style.zIndex = "1000";
            document.body.appendChild(feedback);

            setTimeout(function () {
                if (document.body.contains(feedback)) 
                {
                    document.body.removeChild(feedback);
                }
            }, 1500);
        } 
        else {
            window.location.href = "/betaalstappen/stap1gegevens";
        }
    }
</script>